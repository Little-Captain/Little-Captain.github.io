
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Grammar Structure Â· antlr4-doc</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Little Captain">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="parser-rules.html" />
    
    
    <link rel="prev" href="lexicon.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Sections</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>2.1.</b>
                    
                    Index
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="getting-started.html">
            
                <a href="getting-started.html">
            
                    
                        <b>2.2.</b>
                    
                    Getting Started with ANTLR v4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="lexicon.html">
            
                <a href="lexicon.html">
            
                    
                        <b>2.3.</b>
                    
                    Grammar Lexicon
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.4" data-path="grammars.html">
            
                <a href="grammars.html">
            
                    
                        <b>2.4.</b>
                    
                    Grammar Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="parser-rules.html">
            
                <a href="parser-rules.html">
            
                    
                        <b>2.5.</b>
                    
                    Parser Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="left-recursion.html">
            
                <a href="left-recursion.html">
            
                    
                        <b>2.6.</b>
                    
                    Left-recursive rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="actions.html">
            
                <a href="actions.html">
            
                    
                        <b>2.7.</b>
                    
                    Actions and Attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="lexer-rules.html">
            
                <a href="lexer-rules.html">
            
                    
                        <b>2.8.</b>
                    
                    Lexer Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="wildcard.html">
            
                <a href="wildcard.html">
            
                    
                        <b>2.9.</b>
                    
                    Wildcard Operator and Nongreedy Subrules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="listeners.html">
            
                <a href="listeners.html">
            
                    
                        <b>2.10.</b>
                    
                    Parse Tree Listeners
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="tree-matching.html">
            
                <a href="tree-matching.html">
            
                    
                        <b>2.11.</b>
                    
                    Parse Tree Matching and XPath
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="predicates.html">
            
                <a href="predicates.html">
            
                    
                        <b>2.12.</b>
                    
                    Semantic Predicates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="options.html">
            
                <a href="options.html">
            
                    
                        <b>2.13.</b>
                    
                    Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="tool-options.html">
            
                <a href="tool-options.html">
            
                    
                        <b>2.14.</b>
                    
                    ANTLR Tool Command Line Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="targets.html">
            
                <a href="targets.html">
            
                    
                        <b>2.15.</b>
                    
                    Runtime Libraries and Code Generation Targets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="unicode.html">
            
                <a href="unicode.html">
            
                    
                        <b>2.16.</b>
                    
                    Unicode U+FFFF, U+10FFFF character streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.17" data-path="parsing-binary-files.html">
            
                <a href="parsing-binary-files.html">
            
                    
                        <b>2.17.</b>
                    
                    Parsing binary streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.18" data-path="case-insensitive-lexing.html">
            
                <a href="case-insensitive-lexing.html">
            
                    
                        <b>2.18.</b>
                    
                    Case-Insensitive Lexing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.19" data-path="interpreters.html">
            
                <a href="interpreters.html">
            
                    
                        <b>2.19.</b>
                    
                    Parser and lexer interpreters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.20" data-path="resources.html">
            
                <a href="resources.html">
            
                    
                        <b>2.20.</b>
                    
                    Resources
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Building / releasing ANTLR itself</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="building-antlr.html">
            
                <a href="building-antlr.html">
            
                    
                        <b>3.1.</b>
                    
                    Building ANTLR itself
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="releasing-antlr.html">
            
                <a href="releasing-antlr.html">
            
                    
                        <b>3.2.</b>
                    
                    Cutting an ANTLR Release
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="antlr-project-testing.html">
            
                <a href="antlr-project-testing.html">
            
                    
                        <b>3.3.</b>
                    
                    ANTLR project unit tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="creating-a-language-target.html">
            
                <a href="creating-a-language-target.html">
            
                    
                        <b>3.4.</b>
                    
                    Creating an ANTLR Language Target
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Grammar Structure</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#grammar-structure"><b>1. </b>Grammar Structure</a></li><ul><li><span class="title-icon "></span><a href="#grammar-imports"><b>1.1. </b>Grammar Imports</a></li><li><span class="title-icon "></span><a href="#tokens-section"><b>1.2. </b>Tokens Section</a></li><li><span class="title-icon "></span><a href="#actions-at-the-grammar-level"><b>1.3. </b>Actions at the Grammar Level</a></li></ul></ul></div><a href="#grammar-structure" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="grammar-structure"><a name="grammar-structure" class="anchor-navigation-ex-anchor" href="#grammar-structure"><i class="fa fa-link" aria-hidden="true"></i></a>1. Grammar Structure</h1>
<p>A grammar is essentially a grammar declaration followed by a list of rules, but has the general form:</p>
<pre class="language-"><code>/** Optional javadoc style comment */
grammar Name; &#x2460;
options {...}
import ... ;

tokens {...}
channels {...} // lexer only
@actionName {...}

rule1 // parser and lexer rules, possibly intermingled
...
ruleN
</code></pre><p>The file name containing grammar <code>X</code> must be called <code>X.g4</code>. You can specify options, imports, token specifications, and actions in any order. There can be at most one each of options, imports, and token specifications. All of those elements are optional except for the header &#x2460; and at least one rule. Rules take the basic form:</p>
<pre class="language-"><code>ruleName : alternative1 | ... | alternativeN ;
</code></pre><p>Parser rule names must start with a lowercase letter and lexer rules must start with a capital letter.</p>
<p>Grammars defined without a prefix on the <code>grammar</code> header are combined grammars that can contain both lexical and parser rules. To make a parser grammar that only allows parser rules, use the following header.</p>
<pre class="language-"><code>parser grammar Name;
...
</code></pre><p>And, naturally, a pure lexer grammar looks like this:</p>
<pre class="language-"><code>lexer grammar Name;
...
</code></pre><p>Only lexer grammars can contain <code>mode</code> specifications.</p>
<p>Only lexer grammars can contain custom channels specifications</p>
<pre class="language-"><code>channels {
  WHITESPACE_CHANNEL,
  COMMENTS_CHANNEL
}
</code></pre><p>Those channels can then be used like enums within lexer rules:</p>
<pre class="language-"><code>WS : [ \r\t\n]+ -&gt; channel(WHITESPACE_CHANNEL) ;
</code></pre><p>Sections 15.5, <a href="http://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference" target="_blank">Lexer Rules</a> and Section 15.3, <a href="http://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference" target="_blank">Parser Rules</a> contain details on rule syntax. Section 15.8, Options describes grammar options and Section 15.4, Actions and Attributes has information on grammar-level actions.</p>
<h2 id="grammar-imports"><a name="grammar-imports" class="anchor-navigation-ex-anchor" href="#grammar-imports"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. Grammar Imports</h2>
<p>Grammar <code>imports</code> let you break up a grammar into logical and reusable chunks, as we saw in <a href="http://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference" target="_blank">Importing Grammars</a>. ANTLR treats imported grammars very much like object-oriented programming languages treat superclasses. A grammar inherits all of the rules, tokens specifications, and named actions from the imported grammar. Rules in the &#x201C;main grammar&#x201D; override rules from imported grammars to implement inheritance.</p>
<p>Think of <code>import</code> as more like a smart include statement (which does not include rules that are already defined). The result of all imports is a single combined grammar; the ANTLR code generator sees a complete grammar and has no idea there were imported grammars.</p>
<p>To process a main grammar, the ANTLR tool loads all of the imported grammars into subordinate grammar objects. It then merges the rules, token types, and named actions from the imported grammars into the main grammar. In the diagram below, the grammar on the right illustrates the effect of grammar <code>MyELang</code> importing grammar <code>ELang</code>.</p>
<p><img src="images/combined.png" width="400"></p>
<p><code>MyELang</code> inherits rules <code>stat</code>, <code>WS</code>, and <code>ID</code>, but overrides rule <code>expr</code> and adds <code>INT</code>. Here&#x2019;s a sample build and test run that shows <code>MyELang</code> can recognize integer expressions whereas the original <code>ELang</code> can&#x2019;t. The third, erroneous input statement triggers an error message that also demonstrates the parser was looking for <code>MyELang</code>&#x2019;s expr not <code>ELang</code>&#x2019;s.</p>
<pre class="language-"><code>$ antlr4 MyELang.g4
$ javac MyELang*.java
$ grun MyELang stat
=&gt;     34;
=&gt;     a;
=&gt;     ;
=&gt;     EOF
&lt;=     line 3:0 extraneous input &apos;;&apos; expecting {INT, ID}
</code></pre><p>If there are modes in the main grammar or any of the imported grammars then the import process will import those modes and merge their rules where they are not overridden. In the event any mode becomes empty as all its
rules have been overridden by rules outside the mode this mode will be discarded.</p>
<p>If there were any <code>tokens</code> specifications, the main grammar would merge the token sets. If there were any <code>channel</code> specifications, the main grammar would merge the channel sets. Any named actions such as <code>@members</code> would be merged. In general, you should avoid named actions and actions within rules in imported grammars since that limits their reuse. ANTLR also ignores any options in imported grammars.</p>
<p>Imported grammars can also import other grammars. ANTLR pursues all imported grammars in a depth-first fashion. If two or more imported grammars define rule <code>r</code>, ANTLR chooses the first version of <code>r</code> it finds. In the following diagram, ANTLR examines grammars in the following order <code>Nested</code>, <code>G1</code>, <code>G3</code>, <code>G2</code>.</p>
<p><img src="images/nested.png" width="350"></p>
<p><code>Nested</code> includes the <code>r</code> rule from <code>G3</code> because it sees that version before the <code>r</code> in <code>G2</code>.</p>
<p>Not every kind of grammar can import every other kind of grammar:</p>
<ul>
<li>Lexer grammars can import lexers, including lexers containing modes.</li>
<li>Parsers can import parsers.</li>
<li>Combined grammars can import parsers or lexers without modes.</li>
</ul>
<p>ANTLR adds imported rules to the end of the rule list in a main lexer grammar. That means lexer rules in the main grammar get precedence over imported rules. For example, if a main grammar defines rule <code>IF : &#x2019;if&#x2019; ;</code> and an imported grammar defines rule <code>ID : [a-z]+ ;</code> (which also recognizes <code>if</code>), the imported <code>ID</code> won&#x2019;t hide the main grammar&#x2019;s <code>IF</code> token definition.</p>
<h2 id="tokens-section"><a name="tokens-section" class="anchor-navigation-ex-anchor" href="#tokens-section"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. Tokens Section</h2>
<p>The purpose of the <code>tokens</code> section is to define token types needed by a grammar for which there is no associated lexical rule. The basic syntax is:</p>
<pre class="language-"><code>tokens { Token1, ..., TokenN }
</code></pre><p>Most of the time, the tokens section is used to define token types needed by actions in the grammar as shown in Section 10.3, <a href="http://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference" target="_blank">Recognizing Languages whose Keywords Aren&#x2019;t Fixed</a>:</p>
<pre class="language-"><code>// explicitly define keyword token types to avoid implicit definition warnings
tokens { BEGIN, END, IF, THEN, WHILE }

@lexer::members { // keywords map used in lexer to assign token types
Map<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String,Integer</span><span class="token punctuation">&gt;</span></span> keywords = new HashMap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String,Integer</span><span class="token punctuation">&gt;</span></span>() {{
    put(&quot;begin&quot;, KeywordsParser.BEGIN);
    put(&quot;end&quot;, KeywordsParser.END);
    ...
}};
}
</code></pre><p>The <code>tokens</code> section really just defines a set of tokens to add to the overall set.</p>
<pre class="language-"><code>$ cat Tok.g4
grammar Tok;
tokens { A, B, C }
a : X ;
$ antlr4 Tok.g4
warning(125): Tok.g4:3:4: implicit definition of token X in parser
$ cat Tok.tokens
A=1
B=2
C=3
X=4
</code></pre><h2 id="actions-at-the-grammar-level"><a name="actions-at-the-grammar-level" class="anchor-navigation-ex-anchor" href="#actions-at-the-grammar-level"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Actions at the Grammar Level</h2>
<p>Currently there are only two defined named actions (for the Java target) used outside of grammar rules: <code>header</code> and <code>members</code>. The former injects code into the generated recognizer class file, before the recognizer class definition, and the latter injects code into the recognizer class definition, as fields and methods.</p>
<p>For combined grammars, ANTLR injects the actions into both the parser and the lexer. To restrict an action to the generated parser or lexer, use <code>@parser::name</code> or <code>@lexer::name</code>.</p>
<p>Here&#x2019;s an example where the grammar specifies a package for the generated code:</p>
<pre class="language-"><code>grammar Count;

@header {
package foo;
}

@members {
int count = 0;
}

list
@after {System.out.println(count+&quot; ints&quot;);}
: INT {count++;} (&apos;,&apos; INT {count++;} )*
;

INT : [0-9]+ ;
WS : [ \r\t\n]+ -&gt; skip ;
</code></pre><p>The grammar itself then should be in directory <code>foo</code> so that ANTLR generates code in that same <code>foo</code> directory (at least when not using the <code>-o</code> ANTLR tool option):</p>
<pre class="language-"><code>$ cd foo
$ antlr4 Count.g4 # generates code in the current directory (foo)
$ ls
Count.g4        CountLexer.java    CountParser.java
Count.tokens    CountLexer.tokens
CountBaseListener.java CountListener.java
$ javac *.java
$ cd ..
$ grun foo.Count list
=&gt;     9, 10, 11
=&gt;     EOF
&lt;=     3 ints
</code></pre><p>The Java compiler expects classes in package <code>foo</code> to be in directory <code>foo</code>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="lexicon.html" class="navigation navigation-prev " aria-label="Previous page: Grammar Lexicon">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="parser-rules.html" class="navigation navigation-next " aria-label="Next page: Parser Rules">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Grammar Structure","level":"2.4","depth":1,"next":{"title":"Parser Rules","level":"2.5","depth":1,"path":"chapters/parser-rules.md","ref":"chapters/parser-rules.md","articles":[]},"previous":{"title":"Grammar Lexicon","level":"2.3","depth":1,"path":"chapters/lexicon.md","ref":"chapters/lexicon.md","articles":[]},"dir":"ltr"},"config":{"plugins":["splitter","anchor-navigation-ex","-sharing","sharing-plus","-highlight","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"night","family":"serif","size":2},"anchor-navigation-ex":{"associatedWithSummary":false,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"sharing":{"weibo":true,"qzone":true,"qq":true,"douban":true},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","author":"Little Captain","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"antlr4-doc","gitbook":"*","description":"antlr4-doc"},"file":{"path":"chapters/grammars.md","mtime":"2021-11-11T03:00:11.621Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-11-11T03:19:22.539Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

